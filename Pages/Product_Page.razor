@page "/products"
<PageTitle>All Food</PageTitle>



<div class="container mt-5">
    <h2 class="text-center fw-bold" style="font-family: Cambria; font-size: 32px;">
        All Delicious Foods
    </h2>

    <p class="text-muted text-center mb-5" style="font-size: 18px;">
        Browse the best fast food, snacks & beverages crafted for you.
    </p>

    @if (UploadedFiles == null)
    {
        <div style="margin-top:15%">
            <div class="loader-container">
                <div class="cube-loader"></div>
                <br />
            </div>
            <div class="text-center text-secondary fw-bold mt-4">Bringing All Foods</div>
        </div>
    }
    else
    {
        <div class="row g-4">

            @foreach (var prod in UploadedFiles)
            {
                <div class="col-6 col-md-4 col-lg-3">

                    <div class="card shadow-sm border-0 rounded-4 product-card">

                        <a href="@($"food/{prod.Id}")" style="text-decoration:none; color:black;">
                            <img src="@FixBase64(prod.Base64Img)"
                                 class="card-img-top p-3"
                                 style="height: 180px; object-fit: contain;" />

                            <div class="card-body text-center">
                                <h5 class="fw-bold">@prod.Name</h5>
                            </div>
                        </a>

                    </div>

                </div>
            }

        </div>
    }
</div>

<style>
    .product-card:hover {
        transform: translateY(-6px);
        transition: 0.3s;
        box-shadow: 0 10px 22px rgba(0, 0, 0, 0.1);
    }
</style>

@code {
    private List<Product>? UploadedFiles;

    protected override async Task OnInitializedAsync()
    {
        UploadedFiles = await Http.GetFromJsonAsync<List<Product>>("get-food");
    }

    private string FixBase64(string? base64)
    {
        if (string.IsNullOrWhiteSpace(base64))
            return "";

        base64 = base64.Trim();

        // Remove any incorrect or duplicate prefixes
        string[] wrongPrefixes =
        {
        "data : image/png;base64,",
        "data:image/png;base64,",
        "data:image/png;base64",
        "data:image/PNG;base64,"
    };

        foreach (var p in wrongPrefixes)
        {
            base64 = base64.Replace(p, "", StringComparison.OrdinalIgnoreCase);
        }

        base64 = base64.Trim();

        // Always return correct PNG Data URI
        return $"data:image/png;base64,{base64}";
    }

}
